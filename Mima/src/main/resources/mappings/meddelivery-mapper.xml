<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mima.app.pharmacy.mapper.MedDeliveryMapper">

<select id="selectOne" resultType="medDeliveryVO">
	SELECT * FROM MED_DELIVERY
	WHERE BOOKING_NO = #{bookingNo}
</select>

<select id="phaSelectOne" resultType="medDeliveryVO">
	SELECT M.*, MM.NAME, B.CONSULT_DATE
	FROM MED_DELIVERY M ,BOOKING B, MEMBER MM
	WHERE M.BOOKING_NO = B.BOOKING_NO
	AND B.PT_NO = MM.MEMBER_NO
	AND PHARMACY_NO = #{pharmacyNo}
</select>

<select id="memDelivery" resultType="memDeliveryVO">
	SELECT  M.PHARMACY_NO, 
			MM.NAME, 
			M.BOOKING_NO, 
			B.CONSULT_DATE , 
			M.PRESCRIPTION, 
			P.DEL_ADDR, 
			P.DEL_ADDR2, 
			P.DEL_ADDR3,
			P.DEL_POST_CODE, 
			P.DEL_NOTE  
	FROM MED_DELIVERY M, BOOKING B, PATIENTS P, MEMBER MM
	WHERE B.BOOKING_NO = M.BOOKING_NO
	AND B.PT_NO = P.MEMBER_NO
	AND P.MEMBER_NO = MM.MEMBER_NO
	AND M.PHARMACY_NO = #{pharmacyNo} 
	AND M.DELIVERY_STATUS = 'n'
	<![CDATA[ AND B.CONSULT_DATE <= TO_DATE(SYSDATE, 'YY/MM/DD') ]]>	
</select>

<update id="deliveryStatusUpdate">
	UPDATE MED_DELIVERY
		SET DELIVERY_STATUS = #{deliveryStatus} 
	WHERE BOOKING_NO = #{bookingNo}
</update>

<update id="delCancel">
	UPDATE MED_DELIVERY
	SET DELIVERY_DECLINE = #{deliveryDecline},
	DELIVERY_STATUS = 'c'
	WHERE BOOKING_NO = #{bookingNo}
</update>


</mapper>